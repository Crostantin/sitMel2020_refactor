set schema refactor;
-- step 09 - change x > Y and x < Z to x between Y and Z, check EXPLAIN PLAN, fix implicit type conversion

drop function balance_from_credits_debits;

create function balance_from_credits_debits 
            (IN CREDITS DECIMAL(19,6)
           , IN DEBITS DECIMAL(19,6))
        
        returns balance DECIMAL(19,6) 
as 
begin
    balance = case 
                when :CREDITS != 0.0 
                then TO_DECIMAL (:CREDITS * -1.0, 19, 6)
                else :DEBITS
              end;
end;

WITH _customer_debits_credits
("Customer Code", "Customer Name", "SYSCred", "SYSDeb", "BalDueCred", "BalDueDeb", "Due Days") AS 
    (SELECT 
          OCRD."CardCode" AS "Customer Code"
        , OCRD."CardName" AS "Customer Name"
        , JDT1."SYSCred"
        , JDT1."SYSDeb"
        , JDT1."BalDueCred"
        , JDT1."BalDueDeb"
        , DAYS_BETWEEN(JDT1."DueDate", current_timestamp) AS "Due Days"
     FROM 
            JDT1 INNER JOIN  OCRD 
        ON  JDT1."ShortName" = OCRD."CardCode" 
        AND OCRD."CardType" = 'c' 
    )

SELECT 
      "Customer Code"
    , "Customer Name"
    , SUM( balance_from_credits_debits("SYSCred", "SYSDeb" )) AS "Balance Due"
    , SUM(CASE 
            WHEN ("Due Days" < 0)
            THEN balance_from_credits_debits("BalDueCred", "BalDueDeb")
          END) AS "Future Remit"
    , SUM(CASE 
            WHEN ("Due Days" BETWEEN 0 AND 30) 
            THEN balance_from_credits_debits("BalDueCred", "BalDueDeb")
          END) AS "0-30 days"
    , SUM(CASE 
            WHEN ("Due Days" BETWEEN 31 AND 60) 
            THEN balance_from_credits_debits("BalDueCred", "BalDueDeb")
          END) AS "31 to 60 days"
    , SUM(CASE 
            WHEN ("Due Days" BETWEEN 61 AND 90) 
            THEN balance_from_credits_debits("BalDueCred", "BalDueDeb")
          END) AS "61 to 90 days"
    , SUM(CASE 
            WHEN ("Due Days" BETWEEN 91 AND 120) 
            THEN balance_from_credits_debits("BalDueCred", "BalDueDeb")
          END) AS "91 to 120 days"
    , SUM(CASE 
            WHEN ("Due Days" > 121)
            THEN balance_from_credits_debits("BalDueCred", "BalDueDeb")
           END) AS "121+ days" 
FROM 
    _customer_debits_credits

GROUP BY 
      "Customer Code"
    , "Customer Name" 
HAVING 
    SUM( balance_from_credits_debits("SYSCred", "SYSDeb" ) )  != 0 
ORDER BY 
    "Customer Code";

/*
OPERATOR_NAME         	OPERATOR_DETAILS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 	OPERATOR_PROPERTIES                   	EXECUTION_ENGINE	DATABASE_NAME	SCHEMA_NAME	TABLE_NAME	TABLE_TYPE  	TABLE_SIZE	OUTPUT_SIZE        	SUBTREE_COST          	OPERATOR_ID	PARENT_OPERATOR_ID	LEVEL	POSITION	HOST   	PORT  	TIMESTAMP                	CONNECTION_ID
COLUMN SEARCH         	_CUSTOMER_DEBITS_CREDITS.Customer Code, _CUSTOMER_DEBITS_CREDITS.Customer Name, SUM(TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.SYSCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.SYSCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.SYSDeb, 19, 6)) END, 19, 6)), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) < 0 THEN TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueDeb, 19, 6)) END, 19, 6) ELSE 0.00 END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 0 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 30 THEN TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueDeb, 19, 6)) END, 19, 6) ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 31 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 60 THEN TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueDeb, 19, 6)) END, 19, 6) ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 61 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 90 THEN TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueDeb, 19, 6)) END, 19, 6) ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 91 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 120 THEN TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueDeb, 19, 6)) END, 19, 6) ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) > 121 THEN TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueDeb, 19, 6)) END, 19, 6) ELSE NULL END)                       	LATE MATERIALIZATION, ENUM_BY: CS_JOIN	OLAP            	HXE          	?          	?         	?           	?         	44                 	0.01576284646476067   	1          	?                 	1    	1       	hxehost	39,003	24/01/2020 3:59:02.492 PM	207,852      
  ORDER BY            	_CUSTOMER_DEBITS_CREDITS.Customer Code ASC                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       	                                      	OLAP            	             	?          	?         	?           	?         	44                 	0.015424827375560673  	2          	1                 	2    	1       	       	?     	24/01/2020 3:59:02.492 PM	207,852      
    HAVING            	SUM(TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.SYSCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.SYSCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.SYSDeb, 19, 6)) END, 19, 6)) != 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	                                      	OLAP            	             	?          	?         	?           	?         	44                 	0.015423380626181734  	3          	2                 	3    	1       	       	?     	24/01/2020 3:59:02.492 PM	207,852      
      AGGREGATION     	GROUPING: _CUSTOMER_DEBITS_CREDITS.Customer Code, _CUSTOMER_DEBITS_CREDITS.Customer Name, AGGREGATION: SUM(TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.SYSCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.SYSCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.SYSDeb, 19, 6)) END, 19, 6)), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) < 0 THEN TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueDeb, 19, 6)) END, 19, 6) ELSE 0.00 END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 0 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 30 THEN TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueDeb, 19, 6)) END, 19, 6) ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 31 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 60 THEN TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueDeb, 19, 6)) END, 19, 6) ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 61 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 90 THEN TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueDeb, 19, 6)) END, 19, 6) ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 91 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 120 THEN TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueDeb, 19, 6)) END, 19, 6) ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) > 121 THEN TO_DECIMAL(CASE WHEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) <> 0 THEN TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueCred, 19, 6)) * -1 ELSE TO_DECIMAL(TO_DECIMAL(_CUSTOMER_DEBITS_CREDITS.BalDueDeb, 19, 6)) END, 19, 6) ELSE NULL END)	                                      	OLAP            	             	?          	?         	?           	?         	45                 	0.01542286926254537   	4          	3                 	4    	1       	       	?     	24/01/2020 3:59:02.492 PM	207,852      
        JOIN          	JOIN CONDITION: (INNER) JDT1.ShortName = OCRD.CardCode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           	                                      	OLAP            	             	?          	?         	?           	?         	117,452.99999999999	0.00014780494248429349	5          	4                 	5    	1       	       	?     	24/01/2020 3:59:02.492 PM	207,852      
          COLUMN TABLE	[FACT]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           	                                      	OLAP            	HXE          	REFACTOR   	JDT1      	COLUMN TABLE	112,455   	112,455            	?                     	6          	5                 	6    	1       	hxehost	39,003	24/01/2020 3:59:02.492 PM	207,852      
          COLUMN TABLE	FILTER CONDITION: OCRD.CardType = 'c'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	                                      	OLAP            	HXE          	REFACTOR   	OCRD      	COLUMN TABLE	45        	45                 	?                     	7          	5                 	6    	2       	hxehost	39,003	24/01/2020 3:59:02.492 PM	207,852      

*/    

/*
OPERATOR_NAME         	OPERATOR_DETAILS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               	OPERATOR_PROPERTIES                   	EXECUTION_ENGINE	DATABASE_NAME	SCHEMA_NAME	TABLE_NAME	TABLE_TYPE  	TABLE_SIZE	OUTPUT_SIZE        	SUBTREE_COST          	OPERATOR_ID	PARENT_OPERATOR_ID	LEVEL	POSITION	HOST   	PORT  	TIMESTAMP                	CONNECTION_ID
COLUMN SEARCH         	_CUSTOMER_DEBITS_CREDITS.Customer Code, _CUSTOMER_DEBITS_CREDITS.Customer Name, SUM("REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.SYSCred, _CUSTOMER_DEBITS_CREDITS.SYSDeb).BALANCE), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) < 0 THEN "REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.BalDueCred, _CUSTOMER_DEBITS_CREDITS.BalDueDeb).BALANCE ELSE 0.00 END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 0 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 30 THEN "REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.BalDueCred, _CUSTOMER_DEBITS_CREDITS.BalDueDeb).BALANCE ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 31 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 60 THEN "REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.BalDueCred, _CUSTOMER_DEBITS_CREDITS.BalDueDeb).BALANCE ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 61 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 90 THEN "REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.BalDueCred, _CUSTOMER_DEBITS_CREDITS.BalDueDeb).BALANCE ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 91 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 120 THEN "REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.BalDueCred, _CUSTOMER_DEBITS_CREDITS.BalDueDeb).BALANCE ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) > 121 THEN "REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.BalDueCred, _CUSTOMER_DEBITS_CREDITS.BalDueDeb).BALANCE ELSE NULL END)                       	LATE MATERIALIZATION, ENUM_BY: CS_JOIN	OLAP            	HXE          	?          	?         	?           	?         	44                 	0.01320468453294249   	1          	?                 	1    	1       	hxehost	39,003	24/01/2020 4:03:01.384 PM	207,852      
  ORDER BY            	_CUSTOMER_DEBITS_CREDITS.Customer Code ASC                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     	                                      	OLAP            	             	?          	?         	?           	?         	44                 	0.012866665443742492  	2          	1                 	2    	1       	       	?     	24/01/2020 4:03:01.384 PM	207,852      
    HAVING            	SUM("REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.SYSCred, _CUSTOMER_DEBITS_CREDITS.SYSDeb).BALANCE) != 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  	                                      	OLAP            	             	?          	?         	?           	?         	44                 	0.012865218694363552  	3          	2                 	3    	1       	       	?     	24/01/2020 4:03:01.384 PM	207,852      
      AGGREGATION     	GROUPING: _CUSTOMER_DEBITS_CREDITS.Customer Code, _CUSTOMER_DEBITS_CREDITS.Customer Name, AGGREGATION: SUM("REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.SYSCred, _CUSTOMER_DEBITS_CREDITS.SYSDeb).BALANCE), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) < 0 THEN "REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.BalDueCred, _CUSTOMER_DEBITS_CREDITS.BalDueDeb).BALANCE ELSE 0.00 END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 0 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 30 THEN "REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.BalDueCred, _CUSTOMER_DEBITS_CREDITS.BalDueDeb).BALANCE ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 31 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 60 THEN "REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.BalDueCred, _CUSTOMER_DEBITS_CREDITS.BalDueDeb).BALANCE ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 61 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 90 THEN "REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.BalDueCred, _CUSTOMER_DEBITS_CREDITS.BalDueDeb).BALANCE ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) >= 91 AND DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) <= 120 THEN "REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.BalDueCred, _CUSTOMER_DEBITS_CREDITS.BalDueDeb).BALANCE ELSE NULL END), SUM(CASE WHEN DAYS_BETWEEN(TO_TIMESTAMP(JDT1.DueDate), CURRENT_TIMESTAMP) > 121 THEN "REFACTOR"."BALANCE_FROM_CREDITS_DEBITS"(_CUSTOMER_DEBITS_CREDITS.BalDueCred, _CUSTOMER_DEBITS_CREDITS.BalDueDeb).BALANCE ELSE NULL END)	                                      	OLAP            	             	?          	?         	?           	?         	45                 	0.012864707330727188  	4          	3                 	4    	1       	       	?     	24/01/2020 4:03:01.384 PM	207,852      
        JOIN          	JOIN CONDITION: (INNER) JDT1.ShortName = OCRD.CardCode                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         	                                      	OLAP            	             	?          	?         	?           	?         	117,452.99999999999	0.00014780494248429349	5          	4                 	5    	1       	       	?     	24/01/2020 4:03:01.384 PM	207,852      
          COLUMN TABLE	[FACT]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         	                                      	OLAP            	HXE          	REFACTOR   	JDT1      	COLUMN TABLE	112,455   	112,455            	?                     	6          	5                 	6    	1       	hxehost	39,003	24/01/2020 4:03:01.384 PM	207,852      
          COLUMN TABLE	FILTER CONDITION: OCRD.CardType = 'c'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          	                                      	OLAP            	HXE          	REFACTOR   	OCRD      	COLUMN TABLE	45        	45                 	?                     	7          	5                 	6    	2       	hxehost	39,003	24/01/2020 4:03:01.384 PM	207,852      

*/